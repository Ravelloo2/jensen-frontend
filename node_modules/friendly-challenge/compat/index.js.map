{"version":3,"file":"index.js","sources":["../../node_modules/friendly-pow/base64.js","../../node_modules/friendly-pow/constants.js","../../src/dom.ts","../../src/headless.ts","../../node_modules/friendly-pow/encoding.js","../../node_modules/friendly-pow/puzzle.js","../../src/puzzle.ts","../../src/localization.ts","../../node_modules/friendly-pow/diagnostics.js","../../src/workergroup.ts","../../src/captcha.ts"],"sourcesContent":["// Adapted from the base64-arraybuffer package implementation\r\n// (https://github.com/niklasvh/base64-arraybuffer, MIT licensed)\r\nconst CHARS = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\";\r\nconst EQ_CHAR = \"=\".charCodeAt(0);\r\n// Use a lookup table to find the index.\r\nconst lookup = new Uint8Array(256);\r\nfor (let i = 0; i < CHARS.length; i++) {\r\n    lookup[CHARS.charCodeAt(i)] = i;\r\n}\r\nexport function encode(bytes) {\r\n    const len = bytes.length;\r\n    let base64 = \"\";\r\n    for (let i = 0; i < len; i += 3) {\r\n        const b0 = bytes[i + 0];\r\n        const b1 = bytes[i + 1];\r\n        const b2 = bytes[i + 2];\r\n        base64 += CHARS.charAt(b0 >>> 2);\r\n        base64 += CHARS.charAt(((b0 & 3) << 4) | (b1 >>> 4));\r\n        base64 += CHARS.charAt(((b1 & 15) << 2) | (b2 >>> 6));\r\n        base64 += CHARS.charAt(b2 & 63);\r\n    }\r\n    if (len % 3 === 2) {\r\n        base64 = base64.substring(0, base64.length - 1) + \"=\";\r\n    }\r\n    else if (len % 3 === 1) {\r\n        base64 = base64.substring(0, base64.length - 2) + \"==\";\r\n    }\r\n    return base64;\r\n}\r\nexport function decode(base64) {\r\n    const len = base64.length;\r\n    let bufferLength = len * 3 >>> 2; // * 0.75\r\n    if (base64.charCodeAt(len - 1) === EQ_CHAR)\r\n        bufferLength--;\r\n    if (base64.charCodeAt(len - 2) === EQ_CHAR)\r\n        bufferLength--;\r\n    const bytes = new Uint8Array(bufferLength);\r\n    for (let i = 0, p = 0; i < len; i += 4) {\r\n        const encoded1 = lookup[base64.charCodeAt(i + 0)];\r\n        const encoded2 = lookup[base64.charCodeAt(i + 1)];\r\n        const encoded3 = lookup[base64.charCodeAt(i + 2)];\r\n        const encoded4 = lookup[base64.charCodeAt(i + 3)];\r\n        bytes[p++] = (encoded1 << 2) | (encoded2 >> 4);\r\n        bytes[p++] = ((encoded2 & 15) << 4) | (encoded3 >> 2);\r\n        bytes[p++] = ((encoded3 & 3) << 6) | (encoded4 & 63);\r\n    }\r\n    return bytes;\r\n}\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmFzZTY0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL2Jhc2U2NC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSw2REFBNkQ7QUFDN0QsaUVBQWlFO0FBRWpFLE1BQU0sS0FBSyxHQUFHLGtFQUFrRSxDQUFDO0FBQ2pGLE1BQU0sT0FBTyxHQUFHLEdBQUcsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFFbEMsd0NBQXdDO0FBQ3hDLE1BQU0sTUFBTSxHQUFHLElBQUksVUFBVSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0FBQ25DLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxLQUFLLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFO0lBQ3JDLE1BQU0sQ0FBQyxLQUFLLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0NBQ2pDO0FBRUQsTUFBTSxVQUFVLE1BQU0sQ0FBQyxLQUFpQjtJQUN0QyxNQUFNLEdBQUcsR0FBRyxLQUFLLENBQUMsTUFBTSxDQUFDO0lBQ3pCLElBQUksTUFBTSxHQUFHLEVBQUUsQ0FBQztJQUVoQixLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsR0FBRyxFQUFFLENBQUMsSUFBSSxDQUFDLEVBQUU7UUFDL0IsTUFBTSxFQUFFLEdBQUcsS0FBSyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztRQUN4QixNQUFNLEVBQUUsR0FBRyxLQUFLLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO1FBQ3hCLE1BQU0sRUFBRSxHQUFHLEtBQUssQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7UUFDeEIsTUFBTSxJQUFJLEtBQUssQ0FBQyxNQUFNLENBQUMsRUFBRSxLQUFLLENBQUMsQ0FBQyxDQUFDO1FBQ2pDLE1BQU0sSUFBSSxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFLEdBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxFQUFFLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUN0RCxNQUFNLElBQUksS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRSxHQUFHLEVBQUUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxHQUFHLENBQUMsRUFBRSxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDdEQsTUFBTSxJQUFJLEtBQUssQ0FBQyxNQUFNLENBQUMsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO0tBQ2pDO0lBRUQsSUFBSSxHQUFHLEdBQUcsQ0FBQyxLQUFLLENBQUMsRUFBRTtRQUNqQixNQUFNLEdBQUcsTUFBTSxDQUFDLFNBQVMsQ0FBQyxDQUFDLEVBQUUsTUFBTSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsR0FBRyxHQUFHLENBQUM7S0FDdkQ7U0FBTSxJQUFJLEdBQUcsR0FBRyxDQUFDLEtBQUssQ0FBQyxFQUFFO1FBQ3hCLE1BQU0sR0FBRyxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUMsRUFBRSxNQUFNLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQztLQUN4RDtJQUVELE9BQU8sTUFBTSxDQUFDO0FBQ2hCLENBQUM7QUFFRCxNQUFNLFVBQVUsTUFBTSxDQUFDLE1BQWM7SUFDbkMsTUFBTSxHQUFHLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQztJQUMxQixJQUFJLFlBQVksR0FBRyxHQUFHLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLFNBQVM7SUFFM0MsSUFBSSxNQUFNLENBQUMsVUFBVSxDQUFDLEdBQUcsR0FBRyxDQUFDLENBQUMsS0FBSyxPQUFPO1FBQUUsWUFBWSxFQUFFLENBQUM7SUFDM0QsSUFBSSxNQUFNLENBQUMsVUFBVSxDQUFDLEdBQUcsR0FBRyxDQUFDLENBQUMsS0FBSyxPQUFPO1FBQUUsWUFBWSxFQUFFLENBQUM7SUFFM0QsTUFBTSxLQUFLLEdBQUcsSUFBSSxVQUFVLENBQUMsWUFBWSxDQUFDLENBQUM7SUFDM0MsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsR0FBRyxFQUFFLENBQUMsSUFBSSxDQUFDLEVBQUU7UUFDdEMsTUFBTSxRQUFRLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDbEQsTUFBTSxRQUFRLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDbEQsTUFBTSxRQUFRLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDbEQsTUFBTSxRQUFRLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFFbEQsS0FBSyxDQUFDLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBRSxRQUFRLElBQVUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxRQUFRLElBQUksQ0FBQyxDQUFDLENBQUM7UUFDdEQsS0FBSyxDQUFDLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxDQUFDLFFBQVEsR0FBRyxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUMsR0FBRyxDQUFDLFFBQVEsSUFBSSxDQUFDLENBQUMsQ0FBQztRQUN0RCxLQUFLLENBQUMsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLENBQUMsUUFBUSxHQUFHLENBQUMsQ0FBQyxJQUFLLENBQUMsQ0FBQyxHQUFHLENBQUMsUUFBUSxHQUFHLEVBQUUsQ0FBQyxDQUFDO0tBQ3ZEO0lBRUQsT0FBTyxLQUFLLENBQUM7QUFDZixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLy8gQWRhcHRlZCBmcm9tIHRoZSBiYXNlNjQtYXJyYXlidWZmZXIgcGFja2FnZSBpbXBsZW1lbnRhdGlvblxyXG4vLyAoaHR0cHM6Ly9naXRodWIuY29tL25pa2xhc3ZoL2Jhc2U2NC1hcnJheWJ1ZmZlciwgTUlUIGxpY2Vuc2VkKVxyXG5cclxuY29uc3QgQ0hBUlMgPSBcIkFCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXowMTIzNDU2Nzg5Ky9cIjtcclxuY29uc3QgRVFfQ0hBUiA9IFwiPVwiLmNoYXJDb2RlQXQoMCk7XHJcblxyXG4vLyBVc2UgYSBsb29rdXAgdGFibGUgdG8gZmluZCB0aGUgaW5kZXguXHJcbmNvbnN0IGxvb2t1cCA9IG5ldyBVaW50OEFycmF5KDI1Nik7XHJcbmZvciAobGV0IGkgPSAwOyBpIDwgQ0hBUlMubGVuZ3RoOyBpKyspIHtcclxuICBsb29rdXBbQ0hBUlMuY2hhckNvZGVBdChpKV0gPSBpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZW5jb2RlKGJ5dGVzOiBVaW50OEFycmF5KTogc3RyaW5nIHtcclxuICBjb25zdCBsZW4gPSBieXRlcy5sZW5ndGg7XHJcbiAgbGV0IGJhc2U2NCA9IFwiXCI7XHJcblxyXG4gIGZvciAobGV0IGkgPSAwOyBpIDwgbGVuOyBpICs9IDMpIHtcclxuICAgIGNvbnN0IGIwID0gYnl0ZXNbaSArIDBdO1xyXG4gICAgY29uc3QgYjEgPSBieXRlc1tpICsgMV07XHJcbiAgICBjb25zdCBiMiA9IGJ5dGVzW2kgKyAyXTtcclxuICAgIGJhc2U2NCArPSBDSEFSUy5jaGFyQXQoYjAgPj4+IDIpO1xyXG4gICAgYmFzZTY0ICs9IENIQVJTLmNoYXJBdCgoKGIwICYgIDMpIDw8IDQpIHwgKGIxID4+PiA0KSk7XHJcbiAgICBiYXNlNjQgKz0gQ0hBUlMuY2hhckF0KCgoYjEgJiAxNSkgPDwgMikgfCAoYjIgPj4+IDYpKTtcclxuICAgIGJhc2U2NCArPSBDSEFSUy5jaGFyQXQoYjIgJiA2Myk7XHJcbiAgfVxyXG5cclxuICBpZiAobGVuICUgMyA9PT0gMikge1xyXG4gICAgYmFzZTY0ID0gYmFzZTY0LnN1YnN0cmluZygwLCBiYXNlNjQubGVuZ3RoIC0gMSkgKyBcIj1cIjtcclxuICB9IGVsc2UgaWYgKGxlbiAlIDMgPT09IDEpIHtcclxuICAgIGJhc2U2NCA9IGJhc2U2NC5zdWJzdHJpbmcoMCwgYmFzZTY0Lmxlbmd0aCAtIDIpICsgXCI9PVwiO1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIGJhc2U2NDtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGRlY29kZShiYXNlNjQ6IHN0cmluZyk6IFVpbnQ4QXJyYXkge1xyXG4gIGNvbnN0IGxlbiA9IGJhc2U2NC5sZW5ndGg7XHJcbiAgbGV0IGJ1ZmZlckxlbmd0aCA9IGxlbiAqIDMgPj4+IDI7IC8vICogMC43NVxyXG5cclxuICBpZiAoYmFzZTY0LmNoYXJDb2RlQXQobGVuIC0gMSkgPT09IEVRX0NIQVIpIGJ1ZmZlckxlbmd0aC0tO1xyXG4gIGlmIChiYXNlNjQuY2hhckNvZGVBdChsZW4gLSAyKSA9PT0gRVFfQ0hBUikgYnVmZmVyTGVuZ3RoLS07XHJcblxyXG4gIGNvbnN0IGJ5dGVzID0gbmV3IFVpbnQ4QXJyYXkoYnVmZmVyTGVuZ3RoKTtcclxuICBmb3IgKGxldCBpID0gMCwgcCA9IDA7IGkgPCBsZW47IGkgKz0gNCkge1xyXG4gICAgY29uc3QgZW5jb2RlZDEgPSBsb29rdXBbYmFzZTY0LmNoYXJDb2RlQXQoaSArIDApXTtcclxuICAgIGNvbnN0IGVuY29kZWQyID0gbG9va3VwW2Jhc2U2NC5jaGFyQ29kZUF0KGkgKyAxKV07XHJcbiAgICBjb25zdCBlbmNvZGVkMyA9IGxvb2t1cFtiYXNlNjQuY2hhckNvZGVBdChpICsgMildO1xyXG4gICAgY29uc3QgZW5jb2RlZDQgPSBsb29rdXBbYmFzZTY0LmNoYXJDb2RlQXQoaSArIDMpXTtcclxuXHJcbiAgICBieXRlc1twKytdID0gKCBlbmNvZGVkMSAgICAgICA8PCAyKSB8IChlbmNvZGVkMiA+PiA0KTtcclxuICAgIGJ5dGVzW3ArK10gPSAoKGVuY29kZWQyICYgMTUpIDw8IDQpIHwgKGVuY29kZWQzID4+IDIpO1xyXG4gICAgYnl0ZXNbcCsrXSA9ICgoZW5jb2RlZDMgJiAzKSAgPDwgNikgfCAoZW5jb2RlZDQgJiA2Myk7XHJcbiAgfVxyXG5cclxuICByZXR1cm4gYnl0ZXM7XHJcbn1cclxuIl19","// This is not an enum to save some bytes in the output bundle.\r\nexport const SOLVER_TYPE_JS = 1;\r\nexport const SOLVER_TYPE_WASM = 2;\r\nexport const CHALLENGE_SIZE_BYTES = 128;\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29uc3RhbnRzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL2NvbnN0YW50cy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSwrREFBK0Q7QUFDL0QsTUFBTSxDQUFDLE1BQU0sY0FBYyxHQUFHLENBQUMsQ0FBQztBQUNoQyxNQUFNLENBQUMsTUFBTSxnQkFBZ0IsR0FBRyxDQUFDLENBQUM7QUFFbEMsTUFBTSxDQUFDLE1BQU0sb0JBQW9CLEdBQUcsR0FBRyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLy8gVGhpcyBpcyBub3QgYW4gZW51bSB0byBzYXZlIHNvbWUgYnl0ZXMgaW4gdGhlIG91dHB1dCBidW5kbGUuXHJcbmV4cG9ydCBjb25zdCBTT0xWRVJfVFlQRV9KUyA9IDE7XHJcbmV4cG9ydCBjb25zdCBTT0xWRVJfVFlQRV9XQVNNID0gMjtcclxuXHJcbmV4cG9ydCBjb25zdCBDSEFMTEVOR0VfU0laRV9CWVRFUyA9IDEyODtcclxuIl19","// @ts-ignore\r\nimport css from \"./styles.css\";\r\nimport { ProgressMessage, DoneMessage } from \"./types\";\r\nimport { SOLVER_TYPE_JS } from \"friendly-pow/constants\";\r\nimport { Localization } from \"./localization\";\r\n\r\nconst loaderSVG = `<circle cx=\"12\" cy=\"12\" r=\"8\" stroke-width=\"3\" stroke-dasharray=\"15 10\" fill=\"none\" stroke-linecap=\"round\" transform=\"rotate(0 12 12)\"><animateTransform attributeName=\"transform\" type=\"rotate\" repeatCount=\"indefinite\" dur=\"0.9s\" values=\"0 12 12;360 12 12\"/></circle>`;\r\nconst errorSVG = `<path d=\"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z\"/>`;\r\n\r\n/**\r\n * Base template used for all widget states\r\n * The reason we use raw string interpolation here is so we don't have to ship something like lit-html.\r\n */\r\nfunction getTemplate(\r\n  fieldName: string,\r\n  svgContent: string,\r\n  textContent: string,\r\n  solutionString: string,\r\n  buttonText?: string,\r\n  progress = false,\r\n  debugData?: string,\r\n  additionalContainerClasses?: string\r\n) {\r\n  return `<div class=\"frc-container${additionalContainerClasses ? \" \" + additionalContainerClasses : \"\"}\">\r\n<svg class=\"frc-icon\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" height=\"32\" width=\"32\" viewBox=\"0 0 24 24\">${svgContent}</svg>\r\n<div class=\"frc-content\">\r\n    <span class=\"frc-text\" ${debugData ? `title=\"${debugData}\"` : ``}>${textContent}</span>\r\n    ${buttonText ? `<button type=\"button\" class=\"frc-button\">${buttonText}</button>` : \"\"}\r\n    ${progress ? `<progress class=\"frc-progress\" value=\"0\">0%</progress>` : \"\"}\r\n</div>\r\n</div><span class=\"frc-banner\"><a href=\"https://friendlycaptcha.com/\" rel=\"noopener\" target=\"_blank\"><b>Friendly</b>Captcha ⇗</a></span>\r\n<input name=\"${fieldName}\" class=\"frc-captcha-solution\" type=\"hidden\" value=\"${solutionString}\">`;\r\n}\r\n\r\n/**\r\n * Used when the widget is ready to start solving.\r\n */\r\nexport function getReadyHTML(fieldName: string, l: Localization) {\r\n  return getTemplate(\r\n    fieldName,\r\n    `<path d=\"M17,11c0.34,0,0.67,0.04,1,0.09V6.27L10.5,3L3,6.27v4.91c0,4.54,3.2,8.79,7.5,9.82c0.55-0.13,1.08-0.32,1.6-0.55 C11.41,19.47,11,18.28,11,17C11,13.69,13.69,11,17,11z\"/><path d=\"M17,13c-2.21,0-4,1.79-4,4c0,2.21,1.79,4,4,4s4-1.79,4-4C21,14.79,19.21,13,17,13z M17,14.38\"/>`,\r\n    l.text_ready,\r\n    \".UNSTARTED\",\r\n    l.button_start,\r\n    false\r\n  );\r\n}\r\n\r\n/**\r\n * Used when the widget is retrieving a puzzle\r\n */\r\nexport function getFetchingHTML(fieldName: string, l: Localization) {\r\n  return getTemplate(fieldName, loaderSVG, l.text_fetching, \".FETCHING\", undefined, true);\r\n}\r\n\r\n/**\r\n * Used when the solver is running, displays a progress bar.\r\n */\r\nexport function getRunningHTML(fieldName: string, l: Localization) {\r\n  return getTemplate(fieldName, loaderSVG, l.text_solving, \".UNFINISHED\", undefined, true);\r\n}\r\n\r\nexport function getDoneHTML(fieldName: string, l: Localization, solution: string, data: DoneMessage) {\r\n  const timeData = `Completed: ${data.t.toFixed(0)}s (${((data.h / data.t) * 0.001).toFixed(0)}K/s)${\r\n    data.solver === SOLVER_TYPE_JS ? \" JS Fallback\" : \"\"\r\n  }`;\r\n  return getTemplate(\r\n    fieldName,\r\n    `<title>${timeData}</title><path d=\"M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm-2 16l-4-4 1.41-1.41L10 14.17l6.59-6.59L18 9l-8 8z\"></path>`,\r\n    l.text_completed,\r\n    solution,\r\n    undefined,\r\n    false,\r\n    timeData,\r\n    \"frc-success\"\r\n  );\r\n}\r\n\r\nexport function getExpiredHTML(fieldName: string, l: Localization) {\r\n  return getTemplate(fieldName, errorSVG, l.text_expired, \".EXPIRED\", l.button_restart);\r\n}\r\n\r\nexport function getErrorHTML(fieldName: string, l: Localization, errorDescription: string, recoverable = true, headless = false) {\r\n  return getTemplate(\r\n    fieldName,\r\n    errorSVG,\r\n    `<b>${l.text_error}</b><br>${errorDescription}`,\r\n    headless ? \".HEADLESS_ERROR\" : \".ERROR\",\r\n    recoverable ? l.button_retry : undefined\r\n  );\r\n}\r\n\r\nexport function findCaptchaElements() {\r\n  const elements = document.querySelectorAll(\".frc-captcha\");\r\n  if (elements.length === 0) {\r\n    console.warn(\"FriendlyCaptcha: No div was found with .frc-captcha class\");\r\n  }\r\n  return elements;\r\n}\r\n\r\n/**\r\n * Injects the style if no #frc-style element is already present\r\n * (to support custom stylesheets)\r\n */\r\nexport function injectStyle() {\r\n  if (!document.querySelector(\"#frc-style\")) {\r\n    const styleSheet = document.createElement(\"style\");\r\n    styleSheet.id = \"frc-style\";\r\n    styleSheet.innerHTML = css;\r\n    document.head.appendChild(styleSheet);\r\n  }\r\n}\r\n\r\n/**\r\n * @param element parent element of friendlycaptcha\r\n * @param progress value between 0 and 1\r\n */\r\nexport function updateProgressBar(element: HTMLElement, data: ProgressMessage) {\r\n  const p = element.querySelector(\".frc-progress\") as HTMLProgressElement;\r\n  const perc = (data.i + 1) / data.n;\r\n  if (p) {\r\n    p.value = perc;\r\n    p.innerText = perc.toFixed(2) + \"%\";\r\n    p.title = data.i + 1 + \"/\" + data.n + \" (\" + ((data.h / data.t) * 0.001).toFixed(0) + \"K/s)\";\r\n  }\r\n}\r\n\r\n/**\r\n * Traverses parent nodes until a <form> is found, returns null if not found.\r\n */\r\nexport function findParentFormElement(element: HTMLElement) {\r\n  while (element.tagName !== \"FORM\") {\r\n    element = element.parentElement as HTMLElement;\r\n    if (!element) {\r\n      return null;\r\n    }\r\n  }\r\n  return element;\r\n}\r\n\r\n/**\r\n * Add listener to specified element that will only fire once on focus.\r\n */\r\nexport function executeOnceOnFocusInEvent(element: HTMLElement, listener: (this: HTMLElement, fe: FocusEvent) => any) {\r\n  element.addEventListener(\"focusin\", listener, { once: true, passive: true });\r\n}\r\n","// Defensive init to make it easier to integrate with Gatsby and friends.\r\nlet nav: Navigator;\r\nlet ua: string;\r\nif (typeof navigator !== \"undefined\") {\r\n  nav = navigator;\r\n  ua = nav.userAgent.toLowerCase();\r\n}\r\n\r\n/**\r\n * Headless browser detection on the clientside is imperfect. One can modify any clientside code to disable or change this check,\r\n * and one can spoof whatever is checked here. However, that doesn't make it worthless: it's yet another hurdle for spammers and\r\n * it stops unsophisticated scripters from making any request whatsoever.\r\n */\r\nexport function isHeadless() {\r\n  let correctPrototypes = true;\r\n  try {\r\n    correctPrototypes = PluginArray.prototype === (nav.plugins as any).__proto__;\r\n    if (nav.plugins.length > 0) {\r\n      correctPrototypes = correctPrototypes && Plugin.prototype === (nav.plugins as any)[0].__proto__;\r\n    }\r\n  } catch (e) {\r\n    /* Do nothing, this browser misbehaves in mysterious ways */\r\n  }\r\n\r\n  return (\r\n    //tell-tale bot signs\r\n    ua.indexOf(\"headless\") !== -1 ||\r\n    nav.appVersion.indexOf(\"Headless\") !== -1 ||\r\n    ua.indexOf(\"bot\") !== -1 || // http://www.useragentstring.com/pages/useragentstring.php?typ=Browser\r\n    ua.indexOf(\"crawl\") !== -1 || // Only IE5 has two distributions that has this on windows NT.. so yeah.\r\n    nav.webdriver === true ||\r\n    !nav.language ||\r\n    (nav.languages !== undefined && !nav.languages.length) || // IE 11 does not support NavigatorLanguage.languages https://developer.mozilla.org/en-US/docs/Web/API/NavigatorLanguage/languages\r\n    !correctPrototypes\r\n  );\r\n}\r\n","/**\r\n * Maps a value between 0 and 255 to a difficulty threshold (as uint32)\r\n * Difficulty 0 maps to 99.99% probability of being right on the first attempt\r\n * Anything above 250 needs 2^32 tries on average to solve.\r\n * 150 to 180 seems reasonable\r\n */\r\nexport function difficultyToThreshold(value) {\r\n    if (value > 255) {\r\n        value = 255;\r\n    }\r\n    else if (value < 0) {\r\n        value = 0;\r\n    }\r\n    return (Math.pow(2, (255.999 - value) / 8.0) >>> 0);\r\n}\r\n/**\r\n * Maps a value between 0 and 255 to a time duration in seconds that a puzzle is valid for.\r\n */\r\nexport function expiryToDurationInSeconds(value) {\r\n    if (value > 255) {\r\n        value = 255;\r\n    }\r\n    else if (value < 0) {\r\n        value = 0;\r\n    }\r\n    return value * 300;\r\n}\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZW5jb2RpbmcuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvZW5jb2RpbmcudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7O0dBS0c7QUFDSCxNQUFNLFVBQVUscUJBQXFCLENBQUMsS0FBUztJQUMzQyxJQUFJLEtBQUssR0FBRyxHQUFHLEVBQUU7UUFDYixLQUFLLEdBQUcsR0FBRyxDQUFDO0tBQ2Y7U0FBTSxJQUFJLEtBQUssR0FBRyxDQUFDLEVBQUU7UUFDbEIsS0FBSyxHQUFHLENBQUMsQ0FBQztLQUNiO0lBRUQsT0FBTyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLENBQUMsT0FBTyxHQUFJLEtBQWEsQ0FBQyxHQUFHLEdBQUcsQ0FBUSxLQUFLLENBQUMsQ0FBQyxDQUFDO0FBQ3hFLENBQUM7QUFFRDs7R0FFRztBQUNILE1BQU0sVUFBVSx5QkFBeUIsQ0FBQyxLQUFTO0lBQy9DLElBQUksS0FBSyxHQUFHLEdBQUcsRUFBRTtRQUNiLEtBQUssR0FBRyxHQUFHLENBQUM7S0FDZjtTQUFNLElBQUksS0FBSyxHQUFHLENBQUMsRUFBRTtRQUNsQixLQUFLLEdBQUcsQ0FBQyxDQUFDO0tBQ2I7SUFFRCxPQUFRLEtBQWEsR0FBRyxHQUFHLENBQUM7QUFDaEMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBNYXBzIGEgdmFsdWUgYmV0d2VlbiAwIGFuZCAyNTUgdG8gYSBkaWZmaWN1bHR5IHRocmVzaG9sZCAoYXMgdWludDMyKVxyXG4gKiBEaWZmaWN1bHR5IDAgbWFwcyB0byA5OS45OSUgcHJvYmFiaWxpdHkgb2YgYmVpbmcgcmlnaHQgb24gdGhlIGZpcnN0IGF0dGVtcHRcclxuICogQW55dGhpbmcgYWJvdmUgMjUwIG5lZWRzIDJeMzIgdHJpZXMgb24gYXZlcmFnZSB0byBzb2x2ZS5cclxuICogMTUwIHRvIDE4MCBzZWVtcyByZWFzb25hYmxlXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gZGlmZmljdWx0eVRvVGhyZXNob2xkKHZhbHVlOiB1OCk6IHUzMiB7XHJcbiAgICBpZiAodmFsdWUgPiAyNTUpIHtcclxuICAgICAgICB2YWx1ZSA9IDI1NTtcclxuICAgIH0gZWxzZSBpZiAodmFsdWUgPCAwKSB7XHJcbiAgICAgICAgdmFsdWUgPSAwO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiAoTWF0aC5wb3coMiwgKDI1NS45OTkgLSAodmFsdWUgYXMgZjY0KSkgLyA4LjApIGFzIHUzMiA+Pj4gMCk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBNYXBzIGEgdmFsdWUgYmV0d2VlbiAwIGFuZCAyNTUgdG8gYSB0aW1lIGR1cmF0aW9uIGluIHNlY29uZHMgdGhhdCBhIHB1enpsZSBpcyB2YWxpZCBmb3IuXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gZXhwaXJ5VG9EdXJhdGlvbkluU2Vjb25kcyh2YWx1ZTogdTgpOiB1MzIge1xyXG4gICAgaWYgKHZhbHVlID4gMjU1KSB7XHJcbiAgICAgICAgdmFsdWUgPSAyNTU7XHJcbiAgICB9IGVsc2UgaWYgKHZhbHVlIDwgMCkge1xyXG4gICAgICAgIHZhbHVlID0gMDtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gKHZhbHVlIGFzIHUzMikgKiAzMDA7XHJcbn1cclxuIl19","import { getTimestampInSeconds } from \"./timestamp\";\r\nimport { expiryToDurationInSeconds } from \"./encoding\";\r\nimport { CHALLENGE_SIZE_BYTES } from \"./constants\";\r\nexport const PUZZLE_TIMESTAMP_OFFSET = 0;\r\nexport const ACCOUNT_ID_OFFSET = 4;\r\nexport const APP_ID_OFFSET = 8;\r\nexport const PUZZLE_VERSION_OFFSET = 12;\r\nexport const PUZZLE_EXPIRY_OFFSET = 13;\r\nexport const NUMBER_OF_PUZZLES_OFFSET = 14;\r\nexport const PUZZLE_DIFFICULTY_OFFSET = 15;\r\nexport const PUZZLE_NONCE_OFFSET = 24;\r\nexport const PUZZLE_USER_DATA_OFFSET = 32;\r\nexport const PUZZLE_USER_DATA_MAX_LENGTH = 32;\r\nconst VERSION = 1;\r\n/**\r\n * Generates a puzzle for FriendlyCaptcha.\r\n */\r\nexport function generatePuzzleBuffer(opts) {\r\n    var _a;\r\n    const numBytes = opts.userDataBuffer ? 32 + opts.userDataBuffer.length : 32;\r\n    const puzzle = new Uint8Array(numBytes);\r\n    const v = new DataView(puzzle.buffer);\r\n    const timeUint32 = opts.nowInSeconds === undefined ? getTimestampInSeconds() : opts.nowInSeconds;\r\n    v.setUint32(PUZZLE_TIMESTAMP_OFFSET, timeUint32);\r\n    v.setUint32(ACCOUNT_ID_OFFSET, opts.accountId);\r\n    v.setUint32(APP_ID_OFFSET, opts.appId);\r\n    v.setUint8(PUZZLE_VERSION_OFFSET, VERSION);\r\n    v.setUint8(PUZZLE_EXPIRY_OFFSET, opts.puzzleExpiry);\r\n    v.setUint8(NUMBER_OF_PUZZLES_OFFSET, opts.numberOfPuzzles);\r\n    v.setUint8(PUZZLE_DIFFICULTY_OFFSET, opts.puzzleDifficulty);\r\n    puzzle.set(opts.eightByteNonce, PUZZLE_NONCE_OFFSET);\r\n    if ((_a = opts.userDataBuffer) === null || _a === void 0 ? void 0 : _a.slice(0, PUZZLE_USER_DATA_MAX_LENGTH)) {\r\n        puzzle.set(opts.userDataBuffer, PUZZLE_USER_DATA_OFFSET);\r\n    }\r\n    return puzzle;\r\n}\r\nexport function getPuzzleSolverInputs(puzzleBuffer, numPuzzles) {\r\n    const startingPoints = [];\r\n    for (let i = 0; i < numPuzzles; i++) {\r\n        const input = new Uint8Array(CHALLENGE_SIZE_BYTES);\r\n        input.set(puzzleBuffer);\r\n        input[120] = i;\r\n        startingPoints.push(input);\r\n    }\r\n    return startingPoints;\r\n}\r\n/**\r\n * Combine multiple solutions (8 byte values) into a single array\r\n * @param solutions\r\n */\r\nexport function combineSolutions(solutions) {\r\n    const combined = new Uint8Array(solutions.length * 8);\r\n    for (let i = 0; i < solutions.length; i++) {\r\n        combined.set(solutions[i], i * 8);\r\n    }\r\n    return combined;\r\n}\r\n/**\r\n * Time in seconds the puzzle is valid for.\r\n * @param puzzleBuffer\r\n */\r\nexport function getPuzzleTTL(puzzleBuffer) {\r\n    return expiryToDurationInSeconds(puzzleBuffer[PUZZLE_EXPIRY_OFFSET]);\r\n}\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHV6emxlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL3B1enpsZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUscUJBQXFCLEVBQUUsTUFBTSxhQUFhLENBQUM7QUFDcEQsT0FBTyxFQUFDLHlCQUF5QixFQUFFLE1BQU0sWUFBWSxDQUFDO0FBQ3RELE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxNQUFNLGFBQWEsQ0FBQztBQUVuRCxNQUFNLENBQUMsTUFBTSx1QkFBdUIsR0FBRyxDQUFDLENBQUM7QUFDekMsTUFBTSxDQUFDLE1BQU0saUJBQWlCLEdBQUcsQ0FBQyxDQUFDO0FBQ25DLE1BQU0sQ0FBQyxNQUFNLGFBQWEsR0FBRyxDQUFDLENBQUM7QUFDL0IsTUFBTSxDQUFDLE1BQU0scUJBQXFCLEdBQUcsRUFBRSxDQUFDO0FBQ3hDLE1BQU0sQ0FBQyxNQUFNLG9CQUFvQixHQUFHLEVBQUUsQ0FBQztBQUN2QyxNQUFNLENBQUMsTUFBTSx3QkFBd0IsR0FBRyxFQUFFLENBQUM7QUFDM0MsTUFBTSxDQUFDLE1BQU0sd0JBQXdCLEdBQUcsRUFBRSxDQUFDO0FBQzNDLE1BQU0sQ0FBQyxNQUFNLG1CQUFtQixHQUFHLEVBQUUsQ0FBQztBQUN0QyxNQUFNLENBQUMsTUFBTSx1QkFBdUIsR0FBRyxFQUFFLENBQUM7QUFFMUMsTUFBTSxDQUFDLE1BQU0sMkJBQTJCLEdBQUcsRUFBRSxDQUFDO0FBRTlDLE1BQU0sT0FBTyxHQUFHLENBQUMsQ0FBQztBQUVsQjs7R0FFRztBQUNILE1BQU0sVUFBVSxvQkFBb0IsQ0FBQyxJQUE0Szs7SUFDN00sTUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDLENBQUMsRUFBRSxHQUFHLElBQUksQ0FBQyxjQUFjLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7SUFFNUUsTUFBTSxNQUFNLEdBQUcsSUFBSSxVQUFVLENBQUMsUUFBUSxDQUFDLENBQUM7SUFDeEMsTUFBTSxDQUFDLEdBQUcsSUFBSSxRQUFRLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBRXRDLE1BQU0sVUFBVSxHQUFRLElBQUksQ0FBQyxZQUFZLEtBQUssU0FBUyxDQUFDLENBQUMsQ0FBQyxxQkFBcUIsRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDO0lBRXRHLENBQUMsQ0FBQyxTQUFTLENBQUMsdUJBQXVCLEVBQUUsVUFBVSxDQUFDLENBQUM7SUFDakQsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxpQkFBaUIsRUFBRSxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUM7SUFDL0MsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxhQUFhLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ3ZDLENBQUMsQ0FBQyxRQUFRLENBQUMscUJBQXFCLEVBQUUsT0FBTyxDQUFDLENBQUM7SUFDM0MsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxvQkFBb0IsRUFBRSxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUM7SUFDcEQsQ0FBQyxDQUFDLFFBQVEsQ0FBQyx3QkFBd0IsRUFBRSxJQUFJLENBQUMsZUFBZSxDQUFDLENBQUM7SUFDM0QsQ0FBQyxDQUFDLFFBQVEsQ0FBQyx3QkFBd0IsRUFBRSxJQUFJLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztJQUU1RCxNQUFNLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxjQUFjLEVBQUUsbUJBQW1CLENBQUMsQ0FBQztJQUNyRCxVQUFJLElBQUksQ0FBQyxjQUFjLDBDQUFFLEtBQUssQ0FBQyxDQUFDLEVBQUUsMkJBQTJCLEdBQUc7UUFDNUQsTUFBTSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsY0FBYyxFQUFFLHVCQUF1QixDQUFDLENBQUM7S0FDNUQ7SUFFRCxPQUFPLE1BQU0sQ0FBQztBQUNsQixDQUFDO0FBRUQsTUFBTSxVQUFVLHFCQUFxQixDQUFDLFlBQXdCLEVBQUUsVUFBa0I7SUFDOUUsTUFBTSxjQUFjLEdBQWlCLEVBQUUsQ0FBQztJQUV4QyxLQUFJLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsVUFBVSxFQUFFLENBQUMsRUFBRSxFQUFFO1FBQ2hDLE1BQU0sS0FBSyxHQUFHLElBQUksVUFBVSxDQUFDLG9CQUFvQixDQUFDLENBQUM7UUFDbkQsS0FBSyxDQUFDLEdBQUcsQ0FBQyxZQUFZLENBQUMsQ0FBQztRQUN4QixLQUFLLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ2YsY0FBYyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztLQUM5QjtJQUNELE9BQU8sY0FBYyxDQUFDO0FBQzFCLENBQUM7QUFFRDs7O0dBR0c7QUFDSCxNQUFNLFVBQVUsZ0JBQWdCLENBQUMsU0FBdUI7SUFDcEQsTUFBTSxRQUFRLEdBQUcsSUFBSSxVQUFVLENBQUMsU0FBUyxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQztJQUN0RCxLQUFJLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsU0FBUyxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRTtRQUN0QyxRQUFRLENBQUMsR0FBRyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEdBQUMsQ0FBQyxDQUFDLENBQUM7S0FDbkM7SUFDRCxPQUFPLFFBQVEsQ0FBQztBQUNwQixDQUFDO0FBRUQ7OztHQUdHO0FBQ0gsTUFBTSxVQUFVLFlBQVksQ0FBQyxZQUF3QjtJQUNqRCxPQUFPLHlCQUF5QixDQUFDLFlBQVksQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDLENBQUM7QUFDekUsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGdldFRpbWVzdGFtcEluU2Vjb25kcyB9IGZyb20gXCIuL3RpbWVzdGFtcFwiO1xyXG5pbXBvcnQge2V4cGlyeVRvRHVyYXRpb25JblNlY29uZHMgfSBmcm9tIFwiLi9lbmNvZGluZ1wiO1xyXG5pbXBvcnQgeyBDSEFMTEVOR0VfU0laRV9CWVRFUyB9IGZyb20gXCIuL2NvbnN0YW50c1wiO1xyXG5cclxuZXhwb3J0IGNvbnN0IFBVWlpMRV9USU1FU1RBTVBfT0ZGU0VUID0gMDtcclxuZXhwb3J0IGNvbnN0IEFDQ09VTlRfSURfT0ZGU0VUID0gNDtcclxuZXhwb3J0IGNvbnN0IEFQUF9JRF9PRkZTRVQgPSA4O1xyXG5leHBvcnQgY29uc3QgUFVaWkxFX1ZFUlNJT05fT0ZGU0VUID0gMTI7XHJcbmV4cG9ydCBjb25zdCBQVVpaTEVfRVhQSVJZX09GRlNFVCA9IDEzO1xyXG5leHBvcnQgY29uc3QgTlVNQkVSX09GX1BVWlpMRVNfT0ZGU0VUID0gMTQ7XHJcbmV4cG9ydCBjb25zdCBQVVpaTEVfRElGRklDVUxUWV9PRkZTRVQgPSAxNTtcclxuZXhwb3J0IGNvbnN0IFBVWlpMRV9OT05DRV9PRkZTRVQgPSAyNDtcclxuZXhwb3J0IGNvbnN0IFBVWlpMRV9VU0VSX0RBVEFfT0ZGU0VUID0gMzI7XHJcblxyXG5leHBvcnQgY29uc3QgUFVaWkxFX1VTRVJfREFUQV9NQVhfTEVOR1RIID0gMzI7XHJcblxyXG5jb25zdCBWRVJTSU9OID0gMTtcclxuXHJcbi8qKlxyXG4gKiBHZW5lcmF0ZXMgYSBwdXp6bGUgZm9yIEZyaWVuZGx5Q2FwdGNoYS5cclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBnZW5lcmF0ZVB1enpsZUJ1ZmZlcihvcHRzOiB7bm93SW5TZWNvbmRzPzogdTMyOyBhY2NvdW50SWQ6IHUzMjsgYXBwSWQ6IHUzMjsgbnVtYmVyT2ZQdXp6bGVzOiB1ODsgcHV6emxlRXhwaXJ5OiB1ODsgcHV6emxlRGlmZmljdWx0eTogdTg7IGVpZ2h0Qnl0ZU5vbmNlOiBVaW50OEFycmF5OyB1c2VyRGF0YUJ1ZmZlcj86IFVpbnQ4QXJyYXl9KTogVWludDhBcnJheSB7XHJcbiAgICBjb25zdCBudW1CeXRlcyA9IG9wdHMudXNlckRhdGFCdWZmZXIgPyAzMiArIG9wdHMudXNlckRhdGFCdWZmZXIubGVuZ3RoIDogMzI7XHJcbiAgICBcclxuICAgIGNvbnN0IHB1enpsZSA9IG5ldyBVaW50OEFycmF5KG51bUJ5dGVzKTtcclxuICAgIGNvbnN0IHYgPSBuZXcgRGF0YVZpZXcocHV6emxlLmJ1ZmZlcik7XHJcblxyXG4gICAgY29uc3QgdGltZVVpbnQzMjogdTMyID0gb3B0cy5ub3dJblNlY29uZHMgPT09IHVuZGVmaW5lZCA/IGdldFRpbWVzdGFtcEluU2Vjb25kcygpIDogb3B0cy5ub3dJblNlY29uZHM7XHJcblxyXG4gICAgdi5zZXRVaW50MzIoUFVaWkxFX1RJTUVTVEFNUF9PRkZTRVQsIHRpbWVVaW50MzIpO1xyXG4gICAgdi5zZXRVaW50MzIoQUNDT1VOVF9JRF9PRkZTRVQsIG9wdHMuYWNjb3VudElkKTtcclxuICAgIHYuc2V0VWludDMyKEFQUF9JRF9PRkZTRVQsIG9wdHMuYXBwSWQpO1xyXG4gICAgdi5zZXRVaW50OChQVVpaTEVfVkVSU0lPTl9PRkZTRVQsIFZFUlNJT04pO1xyXG4gICAgdi5zZXRVaW50OChQVVpaTEVfRVhQSVJZX09GRlNFVCwgb3B0cy5wdXp6bGVFeHBpcnkpO1xyXG4gICAgdi5zZXRVaW50OChOVU1CRVJfT0ZfUFVaWkxFU19PRkZTRVQsIG9wdHMubnVtYmVyT2ZQdXp6bGVzKTtcclxuICAgIHYuc2V0VWludDgoUFVaWkxFX0RJRkZJQ1VMVFlfT0ZGU0VULCBvcHRzLnB1enpsZURpZmZpY3VsdHkpO1xyXG5cclxuICAgIHB1enpsZS5zZXQob3B0cy5laWdodEJ5dGVOb25jZSwgUFVaWkxFX05PTkNFX09GRlNFVCk7XHJcbiAgICBpZiAob3B0cy51c2VyRGF0YUJ1ZmZlcj8uc2xpY2UoMCwgUFVaWkxFX1VTRVJfREFUQV9NQVhfTEVOR1RIKSkge1xyXG4gICAgICAgIHB1enpsZS5zZXQob3B0cy51c2VyRGF0YUJ1ZmZlciwgUFVaWkxFX1VTRVJfREFUQV9PRkZTRVQpO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBwdXp6bGU7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRQdXp6bGVTb2x2ZXJJbnB1dHMocHV6emxlQnVmZmVyOiBVaW50OEFycmF5LCBudW1QdXp6bGVzOiBudW1iZXIpOiBVaW50OEFycmF5W10ge1xyXG4gICAgY29uc3Qgc3RhcnRpbmdQb2ludHM6IFVpbnQ4QXJyYXlbXSA9IFtdO1xyXG5cclxuICAgIGZvcihsZXQgaSA9IDA7IGkgPCBudW1QdXp6bGVzOyBpKyspIHtcclxuICAgICAgICBjb25zdCBpbnB1dCA9IG5ldyBVaW50OEFycmF5KENIQUxMRU5HRV9TSVpFX0JZVEVTKTtcclxuICAgICAgICBpbnB1dC5zZXQocHV6emxlQnVmZmVyKTtcclxuICAgICAgICBpbnB1dFsxMjBdID0gaTtcclxuICAgICAgICBzdGFydGluZ1BvaW50cy5wdXNoKGlucHV0KTtcclxuICAgIH1cclxuICAgIHJldHVybiBzdGFydGluZ1BvaW50cztcclxufVxyXG5cclxuLyoqXHJcbiAqIENvbWJpbmUgbXVsdGlwbGUgc29sdXRpb25zICg4IGJ5dGUgdmFsdWVzKSBpbnRvIGEgc2luZ2xlIGFycmF5XHJcbiAqIEBwYXJhbSBzb2x1dGlvbnMgXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gY29tYmluZVNvbHV0aW9ucyhzb2x1dGlvbnM6IFVpbnQ4QXJyYXlbXSk6IFVpbnQ4QXJyYXkge1xyXG4gICAgY29uc3QgY29tYmluZWQgPSBuZXcgVWludDhBcnJheShzb2x1dGlvbnMubGVuZ3RoICogOCk7XHJcbiAgICBmb3IobGV0IGkgPSAwOyBpIDwgc29sdXRpb25zLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgY29tYmluZWQuc2V0KHNvbHV0aW9uc1tpXSwgaSo4KTtcclxuICAgIH1cclxuICAgIHJldHVybiBjb21iaW5lZDtcclxufVxyXG5cclxuLyoqXHJcbiAqIFRpbWUgaW4gc2Vjb25kcyB0aGUgcHV6emxlIGlzIHZhbGlkIGZvci5cclxuICogQHBhcmFtIHB1enpsZUJ1ZmZlciBcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRQdXp6bGVUVEwocHV6emxlQnVmZmVyOiBVaW50OEFycmF5KSB7XHJcbiAgICByZXR1cm4gZXhwaXJ5VG9EdXJhdGlvbkluU2Vjb25kcyhwdXp6bGVCdWZmZXJbUFVaWkxFX0VYUElSWV9PRkZTRVRdKTtcclxufVxyXG4iXX0=","import { decode } from \"friendly-pow/base64\";\r\nimport { difficultyToThreshold } from \"friendly-pow/encoding\";\r\nimport { NUMBER_OF_PUZZLES_OFFSET, PUZZLE_DIFFICULTY_OFFSET, PUZZLE_EXPIRY_OFFSET } from \"friendly-pow/puzzle\";\r\nimport { Localization } from \"./localization\";\r\n\r\nexport interface Puzzle {\r\n  signature: string;\r\n  base64: string;\r\n  buffer: Uint8Array; // input puzzle\r\n  threshold: number; // Related to difficulty\r\n  n: number; // Amount of puzzles to solve\r\n  expiry: number; // Expiry in milliseconds from now\r\n}\r\n\r\nexport function decodeBase64Puzzle(base64Puzzle: string): Puzzle {\r\n  const parts = base64Puzzle.split(\".\");\r\n  const puzzle = parts[1];\r\n  const arr = decode(puzzle);\r\n  return {\r\n    signature: parts[0],\r\n    base64: puzzle,\r\n    buffer: arr,\r\n    n: arr[NUMBER_OF_PUZZLES_OFFSET],\r\n    threshold: difficultyToThreshold(arr[PUZZLE_DIFFICULTY_OFFSET]),\r\n    expiry: arr[PUZZLE_EXPIRY_OFFSET] * 300000,\r\n  };\r\n}\r\n\r\nexport async function getPuzzle(urlsSeparatedByComma: string, siteKey: string, lang: Localization): Promise<string> {\r\n  const urls = urlsSeparatedByComma.split(\",\");\r\n  for (let i = 0; i < urls.length; i++) {\r\n    try {\r\n      const response = await fetchAndRetryWithBackoff(\r\n        urls[i] + \"?sitekey=\" + siteKey,\r\n        { headers: [[\"x-frc-client\", \"js-0.9.0\"]], mode: \"cors\" },\r\n        2\r\n      );\r\n      if (response.ok) {\r\n        const json = await response.json();\r\n        return json.data.puzzle;\r\n      } else {\r\n        let json;\r\n        try {\r\n          json = await response.json();\r\n        } catch (e) {\r\n          /* Do nothing */\r\n        }\r\n\r\n        if (json && json.errors && json.errors[0] === \"endpoint_not_enabled\") {\r\n          throw Error(`Endpoint not allowed (${response.status})`);\r\n        }\r\n\r\n        if (i === urls.length - 1) {\r\n          throw Error(`Response status ${response.status} ${response.statusText}`);\r\n        }\r\n      }\r\n    } catch (e) {\r\n      console.error(\"[FriendlyCaptcha]:\", e);\r\n      throw Error(`${lang.text_fetch_error} <a class=\"frc-err-url\" href=\"${urls[i]}\">${urls[i]}</a>`);\r\n    }\r\n  }\r\n  // This code should never be reached.\r\n  throw Error(`Internal error`);\r\n}\r\n\r\n/**\r\n * Retries given request with exponential backoff (starting with 1000ms delay, multiplying by 4 every time)\r\n * @param url Request (can be string url) to fetch\r\n * @param opts Options for fetch\r\n * @param n Number of times to attempt before giving up.\r\n */\r\nexport async function fetchAndRetryWithBackoff(url: RequestInfo, opts: RequestInit, n: number): Promise<Response> {\r\n  let time = 1000;\r\n  return fetch(url, opts).catch(async (error) => {\r\n    if (n === 0) throw error;\r\n    await new Promise((r) => setTimeout(r, time));\r\n    time *= 4;\r\n    return fetchAndRetryWithBackoff(url, opts, n - 1);\r\n  });\r\n}\r\n","/* eslint-disable @typescript-eslint/camelcase */\r\n// Tip: keep the messages short, there isn't a lot of space in the widget\r\nexport interface Localization {\r\n  // While the widget is starting: usually not visible as it initializes instantly.\r\n  text_init: string;\r\n\r\n  // Before the widget is started\r\n  text_ready: string;\r\n  button_start: string;\r\n\r\n  // While the widget is downloading a puzzle (usually only takes a split second)\r\n  // If this is hard to translate, you could put something simple like \"Loading..\"\r\n  text_fetching: string;\r\n\r\n  // While the widget is solving\r\n  text_solving: string;\r\n\r\n  // Completed\r\n  text_completed: string;\r\n\r\n  // Expired (the puzzle was solved, but then waited say a day without submitting)\r\n  text_expired: string;\r\n  button_restart: string;\r\n\r\n  // Error\r\n  text_error: string;\r\n  button_retry: string;\r\n  // This error message is followed by the URL, a space is added.\r\n  text_fetch_error: string;\r\n}\r\n\r\n// English\r\nconst LANG_EN: Localization = {\r\n  text_init: \"Initializing..\",\r\n\r\n  text_ready: \"Anti-Robot Verification\",\r\n  button_start: \"Click to start verification\",\r\n\r\n  text_fetching: \"Fetching Challenge\",\r\n\r\n  text_solving: \"Verifying you are human..\",\r\n  text_completed: \"I am human\",\r\n\r\n  text_expired: \"Anti-Robot verification expired\",\r\n  button_restart: \"Restart\",\r\n\r\n  text_error: \"Verification failed\",\r\n  button_retry: \"Retry\",\r\n  text_fetch_error: \"Failed to connect to\",\r\n};\r\n\r\n// French\r\nconst LANG_FR: Localization = {\r\n  text_init: \"Chargement..\",\r\n\r\n  text_ready: \"Verification Anti-Robot\",\r\n  button_start: \"Cliquez ici pour vérifier\",\r\n\r\n  text_fetching: \"Chargement du challenge\",\r\n\r\n  text_solving: \"Vérification que vous êtes humain..\",\r\n  text_completed: \"Je suis humain\",\r\n\r\n  text_expired: \"Verification échue\",\r\n  button_restart: \"Recommencer\",\r\n\r\n  text_error: \"Echec de verification\",\r\n  button_retry: \"Recommencer\",\r\n  text_fetch_error: \"Problème de connexion avec\", // TODO: verify by native speaker\r\n};\r\n\r\n// German\r\nconst LANG_DE: Localization = {\r\n  text_init: \"Initialisierung..\",\r\n\r\n  text_ready: \"Anti-Roboter-Verifizierung\",\r\n  button_start: \"Hier klicken\",\r\n\r\n  text_fetching: \"Herausforderung laden..\",\r\n\r\n  text_solving: \"Verifizierung, dass Sie ein Mensch sind..\",\r\n  text_completed: \"Ich bin ein Mensch\",\r\n\r\n  text_expired: \"Verifizierung abgelaufen\",\r\n  button_restart: \"Erneut starten\",\r\n\r\n  text_error: \"Verifizierung fehlgeschlagen\",\r\n  button_retry: \"Erneut versuchen\",\r\n  text_fetch_error: \"Verbindungsproblem mit\", // TODO: verify by native speaker\r\n};\r\n\r\n// Dutch\r\nconst LANG_NL: Localization = {\r\n  text_init: \"Initializeren..\",\r\n\r\n  text_ready: \"Anti-robotverificatie\",\r\n  button_start: \"Klik om te starten\",\r\n\r\n  text_fetching: \"Aan het laden..\",\r\n\r\n  text_solving: \"Anti-robotverificatie bezig..\",\r\n  text_completed: \"Ik ben een mens\",\r\n\r\n  text_expired: \"Verificatie verlopen\",\r\n  button_restart: \"Opnieuw starten\",\r\n\r\n  text_error: \"Verificatie mislukt\",\r\n  button_retry: \"Opnieuw proberen\",\r\n  text_fetch_error: \"Verbinding mislukt met\",\r\n};\r\n\r\n// Italian\r\nconst LANG_IT: Localization = {\r\n  text_init: \"Inizializzazione...\",\r\n\r\n  text_ready: \"Verifica Anti-Robot\",\r\n  button_start: \"Clicca per iniziare\",\r\n\r\n  text_fetching: \"Caricamento...\",\r\n\r\n  text_solving: \"Verificando che sei umano...\",\r\n  text_completed: \"Non sono un robot\",\r\n\r\n  text_expired: \"Verifica Anti-Robot scaduta\",\r\n  button_restart: \"Ricomincia\",\r\n\r\n  text_error: \"Verifica fallita\",\r\n  button_retry: \"Riprova\",\r\n  text_fetch_error: \"Problema di connessione con\", // TODO: verify by native speaker\r\n};\r\n\r\n// Portuguese\r\nconst LANG_PT: Localization = {\r\n  text_init: \"Inicializando..\",\r\n\r\n  text_ready: \"Verificação Anti-Robô\",\r\n  button_start: \"Clique para iniciar verificação\",\r\n\r\n  text_fetching: \"Carregando..\",\r\n\r\n  text_solving: \"Verificando se você é humano..\",\r\n  text_completed: \"Eu sou humano\",\r\n\r\n  text_expired: \"Verificação Anti-Robô expirada\",\r\n  button_restart: \"Reiniciar\",\r\n\r\n  text_error: \"Verificação falhou\",\r\n  button_retry: \"Tentar novamente\",\r\n  text_fetch_error: \"Falha de conexão com\",\r\n};\r\n\r\n// Spanish\r\nconst LANG_ES: Localization = {\r\n  text_init: \"Inicializando..\",\r\n\r\n  text_ready: \"Verificación Anti-Robot\",\r\n  button_start: \"Haga clic para iniciar la verificación\",\r\n\r\n  text_fetching: \"Cargando desafío\",\r\n\r\n  text_solving: \"Verificando que eres humano..\",\r\n  text_completed: \"Soy humano\",\r\n\r\n  text_expired: \"Verificación Anti-Robot expirada\",\r\n  button_restart: \"Reiniciar\",\r\n\r\n  text_error: \"Ha fallado la verificación\",\r\n  button_retry: \"Intentar de nuevo\",\r\n  text_fetch_error: \"Error al conectarse a\",\r\n};\r\n\r\n// Catalan\r\nconst LANG_CA: Localization = {\r\n  text_init: \"Inicialitzant...\",\r\n\r\n  text_ready: \"Verificació Anti-Robot\",\r\n  button_start: \"Fes clic per començar la verificació\",\r\n\r\n  text_fetching: \"Carregant repte\",\r\n\r\n  text_solving: \"Verificant que ets humà..\",\r\n  text_completed: \"Soc humà\",\r\n\r\n  text_expired: \"La verificació Anti-Robot ha expirat\",\r\n  button_restart: \"Reiniciar\",\r\n\r\n  text_error: \"Ha fallat la verificació\",\r\n  button_retry: \"Tornar a provar\",\r\n  text_fetch_error: \"Error connectant a\",\r\n};\r\n\r\n// Japanese\r\nconst LANG_JA: Localization = {\r\n  text_init: \"開始しています...\",\r\n\r\n  text_ready: \"アンチロボット認証\",\r\n  button_start: \"クリックして認証を開始\",\r\n\r\n  text_fetching: \"ロードしています\",\r\n\r\n  text_solving: \"認証中...\",\r\n\r\n  text_completed: \"私はロボットではありません\",\r\n\r\n  text_expired: \"認証の期限が切れています\",\r\n  button_restart: \"再度認証を行う\",\r\n\r\n  text_error: \"認証にエラーが発生しました\",\r\n  button_retry: \"再度認証を行う\",\r\n  text_fetch_error: \"接続ができませんでした\",\r\n};\r\n\r\n// Danish\r\nconst LANG_DA: Localization = {\r\n  text_init: \"Initialiserer..\",\r\n\r\n  text_ready: \"Anti-robot verifikation\",\r\n  button_start: \"Klik for at starte verifikationen\",\r\n\r\n  text_fetching: \"Henter udfordring\",\r\n\r\n  text_solving: \"Bekræfter, at du er menneske..\",\r\n  text_completed: \"Jeg er menneske\",\r\n\r\n  text_expired: \"Anti-Robot-verifikation er udløbet\",\r\n  button_restart: \"Genstart\",\r\n\r\n  text_error: \"Bekræftelse mislykkedes\",\r\n  button_retry: \"Prøv igen\",\r\n  text_fetch_error: \"Det lykkedes ikke at oprette forbindelse til\",\r\n};\r\n\r\nexport const localizations = {\r\n  en: LANG_EN,\r\n  de: LANG_DE,\r\n  nl: LANG_NL,\r\n  fr: LANG_FR,\r\n  it: LANG_IT,\r\n  pt: LANG_PT,\r\n  es: LANG_ES,\r\n  ca: LANG_CA,\r\n  ja: LANG_JA,\r\n  da: LANG_DA,\r\n};\r\n","export function createDiagnosticsBuffer(solverID, timeToSolved) {\r\n    const arr = new Uint8Array(3);\r\n    const view = new DataView(arr.buffer);\r\n    view.setUint8(0, solverID);\r\n    view.setUint16(1, timeToSolved);\r\n    return arr;\r\n}\r\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGlhZ25vc3RpY3MuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvZGlhZ25vc3RpY3MudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsTUFBTSxVQUFVLHVCQUF1QixDQUFDLFFBQWUsRUFBRSxZQUFvQjtJQUN6RSxNQUFNLEdBQUcsR0FBRyxJQUFJLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUM5QixNQUFNLElBQUksR0FBRyxJQUFJLFFBQVEsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDdEMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLEVBQUUsUUFBUSxDQUFDLENBQUM7SUFDM0IsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDLEVBQUUsWUFBWSxDQUFDLENBQUM7SUFFaEMsT0FBTyxHQUFHLENBQUM7QUFDZixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZURpYWdub3N0aWNzQnVmZmVyKHNvbHZlcklEOiAxIHwgMiwgdGltZVRvU29sdmVkOiBudW1iZXIpIHtcclxuICAgIGNvbnN0IGFyciA9IG5ldyBVaW50OEFycmF5KDMpO1xyXG4gICAgY29uc3QgdmlldyA9IG5ldyBEYXRhVmlldyhhcnIuYnVmZmVyKTtcclxuICAgIHZpZXcuc2V0VWludDgoMCwgc29sdmVySUQpO1xyXG4gICAgdmlldy5zZXRVaW50MTYoMSwgdGltZVRvU29sdmVkKTtcclxuXHJcbiAgICByZXR1cm4gYXJyO1xyXG59XHJcbiJdfQ==","import { Puzzle } from \"./puzzle\";\r\nimport { getPuzzleSolverInputs } from \"friendly-pow/puzzle\";\r\nimport { createDiagnosticsBuffer } from \"friendly-pow/diagnostics\";\r\nimport { DoneMessage, ProgressMessage, MessageFromWorker, SolverMessage } from \"./types\";\r\n// @ts-ignore\r\nimport workerString from \"../dist/worker.min.js\";\r\n\r\n// Defensive init to make it easier to integrate with Gatsby and friends.\r\nlet URL: any;\r\nif (typeof window !== \"undefined\") {\r\n  URL = window.URL || window.webkitURL;\r\n}\r\n\r\nexport class WorkerGroup {\r\n\r\n  private workers: Worker[] = [];\r\n  private numPuzzles = 0;\r\n  private startTime = 0;\r\n  private progress = 0;\r\n  private totalHashes = 0;\r\n  private puzzleSolverInputs: Uint8Array[] = [];\r\n  private solutionBuffer: Uint8Array = new Uint8Array(0);\r\n  // initialize some value, so ts is happy\r\n  private solverType: 1 | 2 = 1;\r\n\r\n  private readyCount = 0;\r\n  private startCount = 0;\r\n  private doneCount = 0;\r\n\r\n  public progressCallback: (p: ProgressMessage) => any = () => 0;\r\n  public readyCallback: () => any = () => 0;\r\n  public startedCallback: () => any = () => 0;\r\n  public doneCallback: (d: DoneMessage) => any = () => 0;\r\n  public errorCallback: (e: any) => any = () => 0;\r\n\r\n  public init() {\r\n    if (this.workers.length > 0) {\r\n      for (let i=0; i < this.workers.length; i++) {\r\n        this.workers[i].terminate();\r\n      }\r\n    }\r\n\r\n    this.progress = 0;\r\n    this.totalHashes = 0;\r\n    \r\n    this.readyCount = 0;\r\n    this.startCount = 0;\r\n    this.doneCount = 0;\r\n\r\n    // Setup four workers for now - later we could calculate this depending on the device\r\n    this.workers = new Array(4);\r\n    const workerBlob = new Blob([workerString] as any, { type: \"text/javascript\" });\r\n\r\n    for (let i=0; i<this.workers.length; i++) {\r\n      this.workers[i] = new Worker(URL.createObjectURL(workerBlob));\r\n      this.workers[i].onerror = (e: ErrorEvent) => this.errorCallback(e);\r\n\r\n      this.workers[i].onmessage = (e: any) => {\r\n        const data: MessageFromWorker = e.data;\r\n        if (!data) return;\r\n        if (data.type === \"progress\") {\r\n          this.progress++;\r\n          this.totalHashes += data.h;\r\n          this.progressCallback({\r\n            n: this.numPuzzles,\r\n            h: this.totalHashes,\r\n            t: (Date.now() - this.startTime) / 1000,\r\n            i: this.progress,\r\n          });\r\n        } else if (data.type === \"ready\") {\r\n          this.readyCount++;\r\n          this.solverType = data.solver;\r\n          // We are ready, when all workers are ready\r\n          if (this.readyCount == this.workers.length) {\r\n            this.readyCallback();\r\n          }\r\n        } else if (data.type === \"started\") {\r\n          this.startCount++;\r\n          // We started, when the first worker starts working\r\n          if (this.startCount == 1) {\r\n            this.startTime = Date.now();\r\n            this.startedCallback();\r\n          }\r\n        } else if (data.type === \"done\") {\r\n          this.doneCount++;\r\n          for (let i=data.startIndex; i<this.puzzleSolverInputs.length; i+=this.workers.length) {\r\n            this.solutionBuffer.set(data.solution.subarray(i*8, i*8+8), i*8);\r\n          }\r\n          // We are done, when all workers are done\r\n          if (this.doneCount == this.workers.length) {\r\n            const totalTime = (Date.now() - this.startTime) / 1000;\r\n            this.doneCallback({\r\n              solution: this.solutionBuffer,\r\n              h: this.totalHashes,\r\n              t: totalTime,\r\n              diagnostics: createDiagnosticsBuffer(this.solverType, totalTime),\r\n              solver: this.solverType\r\n            });\r\n          }\r\n        } else if (data.type === \"error\") {\r\n          this.errorCallback(data);\r\n        }\r\n      };\r\n    }\r\n  }\r\n\r\n  public setupSolver(forceJS = false) {\r\n    const msg: SolverMessage = { type: \"solver\", forceJS: forceJS };\r\n    for (let i=0; i<this.workers.length; i++) {\r\n      this.workers[i].postMessage(msg);\r\n    }\r\n  }\r\n\r\n  public start(puzzle: Puzzle) {\r\n    this.puzzleSolverInputs = getPuzzleSolverInputs(puzzle.buffer, puzzle.n);\r\n    this.solutionBuffer = new Uint8Array(8 * puzzle.n);\r\n    this.numPuzzles = puzzle.n;\r\n\r\n    for (let i=0; i<this.workers.length; i++) {\r\n      this.workers[i].postMessage({\r\n        type: \"start\",\r\n        puzzleSolverInputs: this.puzzleSolverInputs,\r\n        threshold: puzzle.threshold,\r\n        n: puzzle.n,\r\n        numWorkers: this.workers.length,\r\n        startIndex: i,\r\n      });\r\n    }\r\n  }\r\n\r\n  public terminateWorkers() {\r\n    if (this.workers.length == 0) return;\r\n    for (let i=0; i<this.workers.length; i++) {\r\n      this.workers[i].terminate();\r\n    }\r\n    this.workers = [];\r\n  }\r\n\r\n}","import { encode } from \"friendly-pow/base64\";\r\nimport {\r\n  getRunningHTML,\r\n  getReadyHTML,\r\n  getDoneHTML,\r\n  updateProgressBar,\r\n  findParentFormElement,\r\n  executeOnceOnFocusInEvent,\r\n  getErrorHTML,\r\n  getFetchingHTML,\r\n  injectStyle,\r\n  getExpiredHTML,\r\n} from \"./dom\";\r\nimport { isHeadless } from \"./headless\";\r\nimport { DoneMessage } from \"./types\";\r\nimport { Puzzle, decodeBase64Puzzle, getPuzzle } from \"./puzzle\";\r\nimport { Localization, localizations } from \"./localization\";\r\nimport { WorkerGroup } from \"./workergroup\";\r\n\r\nconst PUZZLE_ENDPOINT_URL = \"https://api.friendlycaptcha.com/api/v1/puzzle\";\r\n\r\nexport interface WidgetInstanceOptions {\r\n  /**\r\n   * Don't set this to true unless you want to see what the experience is like for people using very old browsers.\r\n   * This does not increase security.\r\n   */\r\n  forceJSFallback: boolean;\r\n  startMode: \"auto\" | \"focus\" | \"none\";\r\n  puzzleEndpoint: string;\r\n  language: keyof (typeof localizations) | Localization;\r\n  solutionFieldName: \"frc-captcha-solution\";\r\n\r\n  sitekey: string;\r\n\r\n  readyCallback: () => any;\r\n  startedCallback: () => any;\r\n  doneCallback: (solution: string) => any;\r\n  errorCallback: (error: any) => any;\r\n}\r\n\r\nexport class WidgetInstance {\r\n  private puzzle?: Puzzle;\r\n\r\n  private workerGroup: WorkerGroup = new WorkerGroup();\r\n\r\n  /**\r\n   * The root element of this widget instance.\r\n   * Warning: it is undefined after `destroy()` has been called.\r\n   */\r\n  private e!: HTMLElement;\r\n\r\n  /**\r\n   * The captcha has been succesfully solved.\r\n   */\r\n  public valid = false;\r\n  private opts: WidgetInstanceOptions;\r\n\r\n  /**\r\n   * Some errors may cause a need for the (worker) to be reinitialized. If this is\r\n   * true `init` will be called again when start is called.\r\n   */\r\n  private needsReInit = false;\r\n\r\n  /**\r\n   * Start() has been called at least once ever.\r\n   */\r\n  private hasBeenStarted = false;\r\n\r\n  private hasBeenDestroyed = false;\r\n\r\n  private lang: Localization;\r\n\r\n  constructor(element: HTMLElement, options: Partial<WidgetInstanceOptions> = {}) {\r\n    this.opts = Object.assign(\r\n      {\r\n        forceJSFallback: false,\r\n        startMode: \"focus\",\r\n        puzzleEndpoint: element.dataset[\"puzzleEndpoint\"] || PUZZLE_ENDPOINT_URL,\r\n        startedCallback: () => 0,\r\n        readyCallback: () => 0,\r\n        doneCallback: () => 0,\r\n        errorCallback: () => 0,\r\n        sitekey: element.dataset[\"sitekey\"] || \"\",\r\n        language: element.dataset[\"lang\"] || \"en\",\r\n        solutionFieldName: element.dataset[\"solutionFieldName\"] || \"frc-captcha-solution\",\r\n      },\r\n      options\r\n    );\r\n    this.e = element;\r\n\r\n    // Load language\r\n    if (typeof this.opts.language === \"string\") {\r\n      let l = (localizations as any)[this.opts.language.toLowerCase()];\r\n      if (l === undefined) {\r\n        console.error('FriendlyCaptcha: language \"' + this.opts.language + '\" not found.');\r\n        // Fall back to English\r\n        l = localizations.en;\r\n      }\r\n      this.lang = l;\r\n    } else {\r\n      // We assign to a copy of the English language localization, so that any missing values will be English\r\n      this.lang = Object.assign(Object.assign({}, localizations.en), this.opts.language);\r\n    }\r\n\r\n    element.innerText = this.lang.text_init;\r\n    injectStyle();\r\n    this.init(this.opts.startMode === \"auto\" || this.e.dataset[\"start\"] === \"auto\");\r\n  }\r\n\r\n  public init(forceStart?: boolean) {\r\n    if (this.hasBeenDestroyed) {\r\n      console.error(\"FriendlyCaptcha widget has been destroyed using destroy(), it can not be used anymore.\");\r\n      return;\r\n    }\r\n    this.initWorkerGroup();\r\n\r\n    if (forceStart) {\r\n      this.start();\r\n    } else if (\r\n      this.e.dataset[\"start\"] !== \"none\" &&\r\n      (this.opts.startMode === \"focus\" || this.e.dataset[\"start\"] === \"focus\")\r\n    ) {\r\n      const form = findParentFormElement(this.e);\r\n      if (form) {\r\n        executeOnceOnFocusInEvent(form, () => {\r\n          if (!this.hasBeenStarted) {\r\n            this.start();\r\n          }\r\n        });\r\n      } else {\r\n        console.log(\"FriendlyCaptcha div seems not to be contained in a form, autostart will not work\");\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Add a listener to the button that calls `this.start` on click.\r\n   */\r\n  private makeButtonStart() {\r\n    const b = this.e.querySelector(\"button\");\r\n    if (b) {\r\n      b.addEventListener(\"click\", (e) => this.start(), { once: true, passive: true });\r\n      b.addEventListener(\"touchstart\", (e) => this.start(), { once: true, passive: true });\r\n    }\r\n  }\r\n\r\n  private onWorkerError(e: any) {\r\n    this.needsReInit = true;\r\n    this.e.innerHTML = getErrorHTML(this.opts.solutionFieldName, this.lang, \"Background worker error \" + e.message);\r\n    this.makeButtonStart();\r\n\r\n    // Just out of precaution\r\n    this.opts.forceJSFallback = true;\r\n  }\r\n\r\n  private initWorkerGroup() {\r\n    this.workerGroup.progressCallback = (progress) => {\r\n      updateProgressBar(this.e, progress);\r\n    };\r\n    this.workerGroup.readyCallback = () => {\r\n      this.e.innerHTML = getReadyHTML(this.opts.solutionFieldName, this.lang);\r\n      this.makeButtonStart();\r\n      this.opts.readyCallback();\r\n    };\r\n    this.workerGroup.startedCallback = () => {\r\n      this.e.innerHTML = getRunningHTML(this.opts.solutionFieldName, this.lang);\r\n      this.opts.startedCallback();\r\n    };\r\n    this.workerGroup.doneCallback = (data) => {\r\n      const solutionPayload = this.handleDone(data);\r\n      this.opts.doneCallback(solutionPayload);\r\n      const callback = this.e.dataset[\"callback\"];\r\n      if (callback) {\r\n        (window as any)[callback](solutionPayload);\r\n      }\r\n    };\r\n    this.workerGroup.errorCallback = (e) => {\r\n      this.onWorkerError(e);\r\n    };\r\n\r\n    this.workerGroup.init();\r\n    this.workerGroup.setupSolver(this.opts.forceJSFallback);\r\n  }\r\n\r\n  private expire() {\r\n    this.e.innerHTML = getExpiredHTML(this.opts.solutionFieldName, this.lang);\r\n    this.makeButtonStart();\r\n  }\r\n\r\n  public async start() {\r\n    if (this.hasBeenDestroyed) {\r\n      console.error(\"Can not start FriendlyCaptcha widget which has been destroyed\");\r\n      return;\r\n    }\r\n\r\n    this.hasBeenStarted = true;\r\n    const sitekey = this.opts.sitekey || this.e.dataset[\"sitekey\"];\r\n    if (!sitekey) {\r\n      console.error(\"FriendlyCaptcha: sitekey not set on frc-captcha element\");\r\n      this.e.innerHTML = getErrorHTML(\r\n        this.opts.solutionFieldName,\r\n        this.lang,\r\n        \"Website problem: sitekey not set\",\r\n        false\r\n      );\r\n      return;\r\n    }\r\n\r\n    if (isHeadless()) {\r\n      this.e.innerHTML = getErrorHTML(\r\n        this.opts.solutionFieldName,\r\n        this.lang,\r\n        \"Browser check failed, try a different browser\",\r\n        false,\r\n        true\r\n      );\r\n      return;\r\n    }\r\n\r\n    if (this.needsReInit) {\r\n      this.needsReInit = false;\r\n      this.init(true);\r\n      return;\r\n    }\r\n\r\n    try {\r\n      this.e.innerHTML = getFetchingHTML(this.opts.solutionFieldName, this.lang);\r\n      this.puzzle = decodeBase64Puzzle(await getPuzzle(this.opts.puzzleEndpoint, sitekey, this.lang));\r\n      setTimeout(() => this.expire(), this.puzzle.expiry - 30000); // 30s grace\r\n    } catch (e) {\r\n      this.e.innerHTML = getErrorHTML(this.opts.solutionFieldName, this.lang, e.message);\r\n      this.makeButtonStart();\r\n      const code = \"error_getting_puzzle\";\r\n\r\n      this.opts.errorCallback({ code, description: e.toString(), error: e });\r\n      const callback = this.e.dataset[\"callback-error\"];\r\n      if (callback) {\r\n        (window as any)[callback](this);\r\n      }\r\n      return;\r\n    }\r\n\r\n    this.workerGroup.start(this.puzzle);\r\n  }\r\n\r\n  /**\r\n   * This is to be called when the puzzle has been succesfully completed.\r\n   * Here the hidden field gets updated with the solution.\r\n   * @param data message from the webworker\r\n   */\r\n  private handleDone(data: DoneMessage) {\r\n    this.valid = true;\r\n    const puzzleSolutionMessage = `${this.puzzle!.signature}.${this.puzzle!.base64}.${encode(data.solution)}.${encode(\r\n      data.diagnostics\r\n    )}`;\r\n    this.e.innerHTML = getDoneHTML(this.opts.solutionFieldName, this.lang, puzzleSolutionMessage, data);\r\n    // this.worker = null; // This literally crashes very old browsers..\r\n    this.needsReInit = true;\r\n\r\n    return puzzleSolutionMessage;\r\n  }\r\n\r\n  /**\r\n   * Cleans up the widget entirely, removing any DOM elements and terminating any background workers.\r\n   * After it is destroyed it can no longer be used for any purpose.\r\n   */\r\n  public destroy() {\r\n    this.workerGroup.terminateWorkers();\r\n    this.needsReInit = false;\r\n    this.hasBeenStarted = false;\r\n    if (this.e) {\r\n      this.e.remove();\r\n      // eslint-disable-next-line @typescript-eslint/ban-ts-ignore\r\n      // @ts-ignore\r\n      delete this.e;\r\n    }\r\n    this.hasBeenDestroyed = true;\r\n  }\r\n\r\n  /**\r\n   * Resets the widget to the initial state.\r\n   * This is useful in situations where the page does not refresh when you submit and the form may be re-submitted again\r\n   */\r\n  public reset() {\r\n    if (this.hasBeenDestroyed) {\r\n      console.error(\"FriendlyCaptcha widget has been destroyed, it can not be used anymore\");\r\n      return;\r\n    }\r\n\r\n    this.workerGroup.terminateWorkers();\r\n    this.needsReInit = false;\r\n    this.hasBeenStarted = false;\r\n    this.init(this.opts.startMode === \"auto\" || this.e.dataset[\"start\"] === \"auto\");\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}